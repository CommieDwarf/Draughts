{"version":3,"file":"board.js","sourceRoot":"","sources":["../../src/components/board.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport TopLabel from './/labels/top-label';\r\nimport LeftLabel from './labels/left-label';\r\nimport Chessboard from './board/chessboard';\r\nimport RightLabel from './labels/right-label';\r\nimport BotLabel from './labels/bot-label';\r\nimport ContextMenu from \"./board/context-menu\";\r\nimport WinMenu from \"./board/winMenu\";\r\n\r\nimport Game, { GAMEMODE } from \"../game\";\r\nimport { Color } from './board/getPieceJSX';\r\nimport { socket } from '../main';\r\nimport { ISquare } from '../engine';\r\nimport { IPlayer } from './lobby/lobby';\r\nimport { Rematch } from '../App';\r\nimport gameMenu from './gameMenu/gameMenu';\r\nimport tsify from 'tsify';\r\n\r\nexport type GameInfo = {\r\n    chessboard: ISquare[],\r\n    id: string | undefined,\r\n    turn: \"black\" | \"white\",\r\n    winner: \"black\" | \"white\" | \"\",\r\n}\r\n\r\ntype MyState = {\r\n    contextMenu: {\r\n        piece: string,\r\n        queen: boolean,\r\n        i: number,\r\n        clientX: number,\r\n        clientY: number,\r\n        showMenu: boolean\r\n    },\r\n    winner: \"\" | Color\r\n}\r\ntype MyProps = {\r\n\r\n}\r\n\r\nexport default class Board extends React.Component<MyProps, MyState> {\r\n\r\n\r\n    props: {\r\n        game: Game;\r\n        restartGame: (gameId: string) => void;\r\n        player: IPlayer;\r\n        rematches: Rematch[]\r\n    }\r\n\r\n    interval: ReturnType<typeof setTimeout> | null;\r\n    contextMenuRef: React.RefObject<HTMLDivElement>\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.props = props;\r\n        this.state = {\r\n            contextMenu: {\r\n                piece: \"\",\r\n                queen: false,\r\n                i: 0,\r\n                clientX: 0,\r\n                clientY: 0,\r\n                showMenu: false,\r\n            },\r\n            winner: \"\",\r\n        };\r\n        this.contextMenuRef = React.createRef();\r\n        this.interval = null;\r\n    }\r\n\r\n    setWinner = (winner: Color) => {\r\n        this.setState({\r\n            winner: winner\r\n        })\r\n    }\r\n\r\n\r\n\r\n    clickHandler = (event: any) => {\r\n        //this.setState({contextMenu: {...this.state.contextMenu, showMenu: false}});\r\n        this.props.game.clickHandler(event);\r\n        if (this.props.game.gameMode == GAMEMODE.ONLINE) {\r\n            let gameInfo: GameInfo = {\r\n                chessboard: this.props.game.engine.chessboard,\r\n                id: this.props.game.id,\r\n                turn: this.props.game.engine.turn,\r\n                winner: this.props.game.engine.winner,\r\n            }\r\n            socket.emit(\"make_move\", gameInfo);\r\n        }\r\n    }\r\n\r\n    hideContextMenu = () => {\r\n        this.setState((prevState) => {\r\n            return {\r\n                contextMenu: { ...prevState.contextMenu, showMenu: false }\r\n            }\r\n        })\r\n    }\r\n\r\n    onContextHandler = (event: any) => {\r\n        event.preventDefault();\r\n        let engine = this.props.game.engine;\r\n\r\n        let square = event.target.closest(\".chessboard__square\");\r\n        if (square && square.className !== \"chessboard__square chessboard__square--white\") {\r\n            let id = square.getAttribute(\"id\");\r\n            const queen = engine.chessboard[id][\"queen\"]\r\n            const piece = engine.chessboard[id][\"piece\"]\r\n            let clientRect = square.getBoundingClientRect();\r\n            let clientX = clientRect.left;\r\n            let clientY = clientRect.top;\r\n            const width = square.offsetWidth;\r\n            const height = square.offsetHeight;\r\n            clientX += width / 2;\r\n            clientY += height / 2 + 10;\r\n\r\n            this.setState({\r\n                contextMenu: {\r\n                    piece: piece,\r\n                    queen: queen,\r\n                    i: id,\r\n                    clientX: clientX,\r\n                    clientY: clientY,\r\n                    showMenu: true,\r\n                }\r\n            })\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    render() {\r\n        if (restartFlag) {\r\n            restartFlag = false;\r\n        }\r\n        let engine = this.props.game.engine;\r\n        const rematch = this.props.rematches.find((r) => r.gameId == this.props.game.id)\r\n\r\n        return (\r\n            <div className=\"board\" onClick={this.clickHandler} onContextMenu={this.onContextHandler}>\r\n                {this.props.game.engine.winner &&\r\n                    <WinMenu winner={engine.winner}\r\n                        restart={this.props.restartGame}\r\n                        game={this.props.game}\r\n                        player={this.props.player}\r\n                        rematch={rematch}\r\n                    />}\r\n                <TopLabel />\r\n                <LeftLabel />\r\n                <RightLabel />\r\n                <Chessboard engine={engine} preview={false} gameCounter={0} game={this.props.game} setWinner={this.setWinner} />\r\n                <BotLabel />\r\n                {this.state.contextMenu.showMenu && <ContextMenu contextMenu={this.state.contextMenu} chessboard={engine.chessboard} hide={this.hideContextMenu} />}\r\n            </div>\r\n        )\r\n    }\r\n\r\n\r\n}\r\n\r\nlet restartFlag = false;\r\n\r\n"]}