{"version":3,"file":"board.js","sourceRoot":"","sources":["../../src/components/board.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { ReactDOM } from 'react';\r\n\r\nimport TopLabel from './/labels/top-label';\r\nimport LeftLabel from './labels/left-label';\r\nimport Chessboard from './board/chessboard';\r\nimport RightLabel from './labels/right-label';\r\nimport BotLabel from './labels/bot-label';\r\nimport ContextMenu from \"./board/context-menu\";\r\nimport WinMenu from \"./board/winMenu\";\r\n\r\nimport Game from \"../game\";\r\nimport { Color } from './board/getPieceJSX';\r\n\r\ntype MyState = {\r\n    contextMenu: {\r\n        piece: string,\r\n        queen: boolean,\r\n        i: number,\r\n        clientX : number,\r\n        clientY: number,\r\n        showMenu: boolean\r\n    },\r\n    winner: \"\" | Color\r\n}\r\ntype MyProps = {\r\n    \r\n}\r\n\r\nexport default class Board extends React.Component<MyProps, MyState> {\r\n    \r\n\r\n    props: {\r\n        game: Game\r\n    }\r\n\r\n    interval: ReturnType<typeof setTimeout> | null;\r\n    contextMenuRef: React.RefObject<HTMLDivElement>\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.props = props;\r\n        this.state = { \r\n            contextMenu: {\r\n                piece: \"\",\r\n                queen : false, \r\n                i : 0,\r\n                clientX : 0, \r\n                clientY : 0,\r\n                showMenu : false,\r\n            },\r\n            winner: \"\",\r\n        };\r\n        this.contextMenuRef = React.createRef();\r\n        this.interval = null;\r\n        this.restartGame = this.restartGame.bind(this);\r\n    }\r\n\r\n    setWinner = (winner: Color) => {\r\n        this.setState({\r\n            winner: winner\r\n        })\r\n    }\r\n\r\n    clickHandler = (event: any) => {\r\n        this.setState({contextMenu: {...this.state.contextMenu, showMenu: false}});\r\n        this.props.game.clickHandler(event);\r\n        this.forceUpdate()\r\n        document.getElementById('games-preview')?.dispatchEvent(new Event(\"click\", {\"bubbles\": true}))\r\n    }\r\n\r\n    onContextHandler = (event: any) => {\r\n        event.preventDefault();\r\n        let engine = this.props.game.engine;\r\n\r\n        let square = event.target.closest(\".square\");\r\n        let id;\r\n        let queen;\r\n        let piece;\r\n        let clientX\r\n        let clientY\r\n        if (square && square.className !== \"square white\") {\r\n            id = square.getAttribute(\"id\");\r\n            queen = engine.chessboard[id][\"queen\"]\r\n            piece = engine.chessboard[id][\"piece\"]\r\n            let clientRect = square.getBoundingClientRect();\r\n            clientX = clientRect.left;\r\n            clientY = clientRect.top;\r\n            let width = square.offsetWidth;\r\n            let height = square.offsetHeight;\r\n            clientX += width / 2;\r\n            clientY += height / 2 + 10;\r\n\r\n            this.setState({contextMenu: {\r\n                piece: piece,\r\n                queen : queen, \r\n                i : id,\r\n                clientX : clientX, \r\n                clientY : clientY,\r\n                showMenu : true,\r\n            }})\r\n        }\r\n        \r\n        return false;\r\n    }\r\n\r\n\r\n    componentDidUpdate() {\r\n        let engine = this.props.game.engine;\r\n        // context menu managment\r\n        let contextMenu = ReactDOM.findDOMNode() //this.contextMenuRef;\r\n        if (contextMenu) {\r\n            let attribute = \"left: \" + this.state.contextMenu.clientX + \"px; \"\r\n            attribute += \"top: \" + this.state.contextMenu.clientY + \"px; \"\r\n            if (this.state.contextMenu.showMenu) {\r\n                attribute += \"visibility: visible\";\r\n            } else {\r\n                attribute += \"visibility: hidden\";\r\n            }\r\n            contextMenu.setAttribute(\"style\", attribute);\r\n        }\r\n\r\n        // win menu managment\r\n        let winMenu = document.getElementById('winMenu');\r\n        if (winMenu) {\r\n            if (engine.winner) {\r\n                winMenu.setAttribute(\"style\", \"visibility: visible\");\r\n            } else {\r\n                winMenu.setAttribute(\"style\", \"visibility: hidden\");\r\n            }\r\n        }\r\n    }\r\n\r\n    restartGame() {\r\n\r\n    }\r\n\r\n    onForceUpdateHandler = () => {\r\n        this.forceUpdate();\r\n    }\r\n\r\n    render() {\r\n        if (restartFlag) {\r\n            restartFlag = false;\r\n        }\r\n        let engine = this.props.game.engine;\r\n        let ctxMenu = this.state.contextMenu;\r\n\r\n        return (\r\n            <div id=\"game\"  onClick={this.clickHandler} onContextMenu={this.onContextHandler}>\r\n                <WinMenu winner={engine.winner} restart={this.restartGame}/>\r\n                <TopLabel/>\r\n                <LeftLabel/>\r\n                <RightLabel/>\r\n                <Chessboard engine = {engine} preview = {false} id={0} game={this.props.game} setWinner={this.setWinner}/>\r\n                <BotLabel/>\r\n                <ContextMenu ctxRef={this.contextMenuRef} piece={ctxMenu.piece} queen ={ctxMenu.queen} id={ctxMenu.i} chessboard={engine.chessboard}/>\r\n            </div>\r\n        )\r\n    }\r\n\r\n\r\n}\r\n\r\nlet restartFlag = false;\r\n\r\n"]}