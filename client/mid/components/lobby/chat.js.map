{"version":3,"file":"Chat.js","sourceRoot":"","sources":["../../../src/components/lobby/Chat.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport Message from \"./Message\";\r\nimport { IPlayer } from \"./Lobby\";\r\nimport { socket } from \"../../main\";\r\nimport Emojis from \"./Emojis\";\r\n\r\ninterface IMessage {\r\n  content: string;\r\n  author: IPlayer;\r\n  room: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n};\r\n\r\ninterface Room  {\r\n  name: string;\r\n  id: string;\r\n  unread: boolean;\r\n  hover: boolean;\r\n  isWriting: boolean;\r\n};\r\n\r\ninterface Props {\r\n  player: IPlayer;\r\n    currentRoom: Room;\r\n    createRoom: (name: string) => void;\r\n    rooms: Room[];\r\n    isWriting: boolean;\r\n    setRoomProperty: (\r\n      id: string,\r\n      propertyName: string,\r\n      propertyValue: any\r\n    ) => void;\r\n};\r\ninterface State {\r\n  messages: IMessage[];\r\n  message: string;\r\n  showEmojis: boolean;\r\n};\r\n\r\nexport default class Chat extends React.Component<Props, State> {\r\n\r\n  thisPlayerId: string;\r\n  messagesDivRef: React.RefObject<HTMLDivElement>;\r\n  emoContainerDivRef: React.RefObject<HTMLDivElement>;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      messages: [],\r\n      message: \"\",\r\n      showEmojis: false,\r\n    };\r\n    this.thisPlayerId = socket.id;\r\n    this.messagesDivRef = React.createRef();\r\n    this.emoContainerDivRef = React.createRef();\r\n  }\r\n\r\n  scrollToBot() {\r\n    if (this.messagesDivRef.current) {\r\n      this.messagesDivRef.current.scrollBy({\r\n        top: this.messagesDivRef.current.scrollHeight + 9999,\r\n      });\r\n    }\r\n  }\r\n\r\n  sendMesage = () => {\r\n    if (this.state.message.replace(/\\s/g, \"\").length) {\r\n      socket.emit(\"done_writing\", this.props.currentRoom);\r\n      const message = {\r\n        content: this.state.message,\r\n        author: this.props.player,\r\n        room: this.props.currentRoom,\r\n      };\r\n      socket.emit(\"send_message\", message);\r\n      this.setState((prev) => {\r\n        return {\r\n          messages: [\r\n            ...prev.messages,\r\n            {\r\n              content: this.state.message,\r\n              author: this.props.player,\r\n              room: this.props.currentRoom,\r\n            },\r\n          ],\r\n          message: \"\",\r\n        };\r\n      });\r\n      this.scrollToBot();\r\n    }\r\n    document.getElementById(\"input\")?.focus();\r\n  };\r\n\r\n  receiveMessage(message: IMessage) {\r\n    if (!this.props.rooms.some((room) => room.id == message.room.id)) {\r\n      this.props.createRoom(message.author.name);\r\n    }\r\n    if (message.room.id !== this.props.currentRoom.id) {\r\n      this.props.setRoomProperty(message.room.id, \"unread\", true);\r\n    }\r\n    this.setState((prevState) => {\r\n      return {\r\n        messages: [...prevState.messages, message],\r\n      };\r\n    });\r\n    this.scrollToBot();\r\n  }\r\n\r\n  onChangeHandler = (event: any) => {\r\n    const target = event.target as HTMLInputElement;\r\n    this.setState({ message: target.value });\r\n    socket.emit(\"writing\", this.props.currentRoom);\r\n    setTimeout(() => {\r\n      socket.emit(\"done_writing\", this.props.currentRoom);\r\n    }, 4000);\r\n  };\r\n\r\n  handleEnter = (event: KeyboardEvent) => {\r\n    if (event.key == \"Enter\") {\r\n      this.sendMesage();\r\n    }\r\n  };\r\n\r\n  toggleEmojis = () => {\r\n    if (this.state.showEmojis) {\r\n      this.setState({ showEmojis: false });\r\n    } else {\r\n      this.setState({ showEmojis: true });\r\n    }\r\n  };\r\n\r\n  pickEmoji = (emoji: string) => {\r\n    this.setState((prevState) => {\r\n      return {\r\n        message: prevState.message + \" \" + emoji + \" \",\r\n      };\r\n    });\r\n  };\r\n\r\n  handleOutsideClick = (event: MouseEvent) => {\r\n    const target = event.target as HTMLElement;\r\n    if (\r\n      !target.closest(\".lobby__emoji-container\") &&\r\n      !target.closest(\".lobby__emo-button\")\r\n    ) {\r\n      this.setState({ showEmojis: false });\r\n    }\r\n  };\r\n\r\n  setEmojiBottom() {\r\n    if (this.emoContainerDivRef.current && this.messagesDivRef.current) {\r\n      this.emoContainerDivRef.current.setAttribute(\r\n        \"style\",\r\n        \"top: \" + (this.messagesDivRef.current.scrollHeight - 85) + \"px\"\r\n      );\r\n      console.log(\"to bottom\");\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    socket.on(\"get_message\", (msg) => {\r\n      this.receiveMessage(msg);\r\n    });\r\n    document.addEventListener(\"keydown\", this.handleEnter);\r\n    document.addEventListener(\"click\", this.handleOutsideClick);\r\n  }\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keydown\", this.handleEnter);\r\n    socket.off();\r\n    document.removeEventListener(\"click\", this.handleOutsideClick);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.scrollToBot();\r\n    this.setEmojiBottom();\r\n  }\r\n\r\n  render() {\r\n    let messages = this.state.messages.map((msg, id) => {\r\n      if (msg.room.id == this.props.currentRoom.id) {\r\n        return (\r\n          <Message\r\n            author={msg.author}\r\n            content={msg.content}\r\n            key={id}\r\n            thisPlayerId={this.thisPlayerId}\r\n          />\r\n        );\r\n      }\r\n    });\r\n\r\n    const emoButtonClass = this.state.showEmojis ? \"white color-black\" : \"\";\r\n\r\n    return (\r\n      <div className=\"lobby__chat\">\r\n        <div className=\"lobby__messages\" ref={this.messagesDivRef}>\r\n          {messages}\r\n          {this.props.isWriting && (\r\n            <div className=\"lobby__someone-writing\">\r\n              Someone is writing\r\n              <div className=\"lobby__dot-wrapper lobby__dot-wrapper--1\">\r\n                <div id=\"dot-1\" className=\"lobby__dot\"></div>\r\n              </div>\r\n              <div id=\"dot-wrapper-2\" className=\"lobby__dot-wrapper\">\r\n                <div id=\"dot-2\" className=\"lobby__dot\"></div>\r\n              </div>\r\n              <div id=\"dot-wrapper-3\" className=\"lobby__dot-wrapper\">\r\n                <div id=\"dot-3\" className=\"lobby__dot\"></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {this.state.showEmojis && (\r\n            <Emojis\r\n              pickEmoji={this.pickEmoji}\r\n              emoContainerDivRef={this.emoContainerDivRef}\r\n            />\r\n          )}\r\n        </div>\r\n        <input\r\n          className=\"lobby__input\"\r\n          type=\"text\"\r\n          onChange={this.onChangeHandler}\r\n          value={this.state.message}\r\n          autoComplete=\"off\"\r\n        ></input>\r\n\r\n        <div\r\n          className={\"lobby__emo-button no-select \" + emoButtonClass}\r\n          onClick={this.toggleEmojis}\r\n        >\r\n          <i className=\"icon-emo-happy\"></i>\r\n        </div>\r\n        <div className=\"lobby__send-button no-select\" onClick={this.sendMesage}>\r\n          <i className=\"icon-right-open-outline\"></i>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}