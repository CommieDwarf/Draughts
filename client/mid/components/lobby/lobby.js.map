{"version":3,"file":"lobby.js","sourceRoot":"","sources":["../../../src/components/lobby/lobby.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { MouseEvent, Ref } from \"react\";\r\nimport Chat from \"./chat\";\r\nimport { socket } from \"../../main\";\r\nimport Players from \"./players\";\r\n\r\n\r\n\r\nexport interface IPlayer {\r\n    name: string,\r\n    avatar: {\r\n        theme: string,\r\n        shape: string,\r\n    },\r\n    id: string,\r\n}\r\n\r\ntype Props = {\r\n\r\n}\r\ntype State = {\r\n    players: IPlayer[],\r\n    rooms: {\r\n        name: string,\r\n        id: string\r\n    }[],\r\n    currentRoom: {\r\n        name: string,\r\n        id: string\r\n    },\r\n    roomInvitable: boolean,\r\n}\r\n\r\n\r\nexport default class Lobby extends React.Component<Props, State> {\r\n\r\n    props: {\r\n        name: string,\r\n    }\r\n    playersRef: React.RefObject<HTMLDivElement>\r\n    createRoomRef: React.RefObject<HTMLDivElement>\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.props = props;\r\n        this.state = {\r\n            players: [],\r\n            rooms: [{name: \"global room\", id: \"global\"}],\r\n            currentRoom: {name: \"global room\", id: \"global\"},\r\n            roomInvitable: false,\r\n        }\r\n        this.playersRef = React.createRef();\r\n        this.createRoomRef = React.createRef();\r\n    }\r\n\r\n    getRoomId(name: string) {\r\n        let roomIdPart1;\r\n        let roomIdPart2;\r\n        if (name > this.props.name) {\r\n            roomIdPart1 = name;\r\n            roomIdPart2 = this.props.name;\r\n        } else {\r\n            roomIdPart1 = this.props.name;\r\n            roomIdPart2 = name;\r\n        }\r\n        return roomIdPart1 + roomIdPart2; \r\n    }\r\n\r\n    createRoom = (name: string) => {\r\n        let roomId = this.getRoomId(name);\r\n        if (!this.state.rooms.some((room) => room.name == name) && name !== this.props.name) {\r\n            socket.emit(\"join_room\", {name, id: roomId});\r\n            this.setState(prevState => {\r\n                return {\r\n                    rooms: [...prevState.rooms, {name, id: roomId}],\r\n                    currentRoom: {name, id: roomId},\r\n                    roomInvitable: false,\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    handlePlayerInvite = (event: React.MouseEvent) => {\r\n        const target = event.target as HTMLElement;\r\n        const player = target.closest(\".lobby__player\")\r\n        \r\n     \r\n        if (player && !this.state.rooms.some((room) => {room.name == player.id}) && this.state.roomInvitable) {\r\n            this.createRoom(player.id);\r\n        }\r\n    }\r\n\r\n    handleClickNewRoom = () => {\r\n        this.setState({ roomInvitable: true });\r\n    }\r\n\r\n    handleOutsidePlayersClick = (event: any) => {\r\n        const { target } = event\r\n        if (!this.playersRef.current?.contains(target) && !this.createRoomRef.current?.contains(target)) {\r\n            this.setState({ roomInvitable: false });\r\n        }\r\n    }\r\n\r\n    switchRoomHandler = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        const target = event.target as HTMLDivElement;\r\n        const room = target.closest(\".lobby__room\");\r\n        const id = room?.id;\r\n        const name = room?.textContent;\r\n        if (name && id && id !== \"global\") {\r\n            this.setState({currentRoom: {name, id: this.getRoomId(name)}})\r\n        } else {\r\n            this.setState({currentRoom: {name: \"global room\", id: \"global\"}})\r\n        }\r\n    }\r\n\r\n    componentDidMount = () => {\r\n        socket.on(\"players_update\", (players) => {\r\n            this.setState({ players })\r\n        })\r\n        socket.on(\"get_room\", (socket) => {\r\n            if (this.props.name == socket.target) {\r\n                this.createRoom(socket.author)\r\n            }\r\n        })\r\n        document.addEventListener('click', this.handleOutsidePlayersClick);\r\n\r\n    }\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleOutsidePlayersClick);\r\n        socket.off(\"players_update\");\r\n        socket.off(\"get_room\")\r\n    }\r\n\r\n    render() {\r\n\r\n        const player = this.state.players.find((player) => player.name == this.props.name)\r\n\r\n        let rooms = this.state.rooms.map((room, id) => {\r\n            let roomClass = \"\";\r\n            if (room.name == this.state.currentRoom.name) {\r\n                roomClass = \"lobby__room--current\";\r\n            }\r\n            return <div className={\"lobby__room no-select \" + roomClass} id={room.id} key={id} onClick={this.switchRoomHandler}>{room.name}</div>\r\n        })\r\n\r\n        let newRoomButtonClass = \"\";\r\n        if (this.state.roomInvitable) {\r\n            newRoomButtonClass = \"lobby__new-room-button--green\";\r\n        }\r\n\r\n        return (\r\n            <div className=\"lobby\">\r\n                <div className=\"lobby__invite-button\">\r\n                    Invite\r\n                </div>\r\n                <div className=\"lobby__players\" ref={this.playersRef}>\r\n                    <Players players={this.state.players}\r\n                        invitable={this.state.roomInvitable}\r\n                        handlePlayerInvite={this.handlePlayerInvite}\r\n                        rooms={this.state.rooms}\r\n                    />;\r\n                </div>\r\n                <div className=\"lobby__rooms\">\r\n                    {rooms}\r\n                    <div\r\n                        className={\"lobby__new-room-button no-select \" + newRoomButtonClass}\r\n                        onClick={this.handleClickNewRoom} ref={this.createRoomRef}>\r\n                        <i className=\"icon-user-plus\"></i>\r\n                    </div>\r\n                </div>\r\n                {player && <Chat player={player} currentRoom={this.state.currentRoom} />}\r\n            </div>\r\n        )\r\n    }\r\n}"]}