{"version":3,"file":"lobby.js","sourceRoot":"","sources":["../../../src/components/lobby/lobby.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,gDAAmC;AACnC,gDAA0B;AAC1B,mCAAoC;AACpC,sDAAgC;AAwBhC;IAAmC,yBAA6B;IAY5D,eAAY,KAAU;QAAtB,YACI,kBAAM,KAAK,CAAC,SAUf;QAED,gBAAU,GAAG,UAAC,IAAY;YACtB,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,KAAI,CAAC,KAAK,CAAC,IAAI,EAAE;gBAC9D,KAAI,CAAC,QAAQ,CAAC,UAAA,SAAS;oBACnB,OAAO;wBACH,KAAK,kCAAM,SAAS,CAAC,KAAK,UAAE,IAAI,SAAC;wBACjC,WAAW,EAAE,IAAI;wBACjB,SAAS,EAAE,KAAK;qBACnB,CAAA;gBACL,CAAC,CAAC,CAAC;aACN;YACD,IAAI,QAAQ,GAAG,KAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;QAC1C,CAAC,CAAA;QAED,wBAAkB,GAAG,UAAC,KAAU;YAC5B,IAAM,MAAM,GAAG,KAAK,CAAC,MAAqB,CAAC;YAC3C,IAAI,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;YAEtC,IAAI,KAAI,CAAC,KAAK,CAAC,SAAS,IAAI,MAAM,EAAE;gBAChC,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;gBAC3B,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;aACzB;QACL,CAAC,CAAA;QAED,wBAAkB,GAAE;YAChB,KAAI,CAAC,QAAQ,CAAC,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAC;QACrC,CAAC,CAAA;QAED,+BAAyB,GAAG,UAAC,KAAU;;YAC5B,IAAA,MAAM,GAAI,KAAK,OAAT,CAAS;YACtB,IAAI,CAAC,CAAA,MAAA,KAAI,CAAC,UAAU,CAAC,OAAO,0CAAE,QAAQ,CAAC,MAAM,CAAC,CAAA,IAAI,CAAC,CAAA,MAAA,KAAI,CAAC,aAAa,CAAC,OAAO,0CAAE,QAAQ,CAAC,MAAM,CAAC,CAAA,EAAE;gBAC7F,KAAI,CAAC,QAAQ,CAAC,EAAC,SAAS,EAAE,KAAK,EAAC,CAAC,CAAC;aACrC;QAEL,CAAC,CAAA;QAED,uBAAiB,GAAG;YAChB,aAAM,CAAC,EAAE,CAAC,gBAAgB,EAAE,UAAC,OAAO;gBAChC,KAAI,CAAC,QAAQ,CAAC,EAAC,OAAO,SAAA,EAAC,CAAC,CAAA;YAC5B,CAAC,CAAC,CAAA;YACF,QAAQ,CAAC,gBAAgB,CAAC,OAAO,EAAE,KAAI,CAAC,yBAAyB,CAAC,CAAC;QAEvE,CAAC,CAAA;QApDG,KAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,KAAI,CAAC,KAAK,GAAG;YACT,OAAO,EAAE,EAAE;YACX,KAAK,EAAE,CAAC,aAAa,CAAC;YACtB,WAAW,EAAE,aAAa;YAC1B,SAAS,EAAE,KAAK;SACnB,CAAA;QACD,KAAI,CAAC,UAAU,GAAG,eAAK,CAAC,SAAS,EAAE,CAAC;QACpC,KAAI,CAAC,aAAa,GAAG,eAAK,CAAC,SAAS,EAAE,CAAC;;IAC3C,CAAC;IA4CD,oCAAoB,GAApB;QACI,QAAQ,CAAC,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC,yBAAyB,CAAC,CAAC;QACtE,aAAM,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAA;IAChC,CAAC;IAED,sBAAM,GAAN;QAAA,iBAuCC;QApCG,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,UAAC,MAAM,IAAK,OAAA,MAAM,CAAC,IAAI,IAAI,KAAI,CAAC,KAAK,CAAC,IAAI,EAA9B,CAA8B,CAAC,CAAA;QAElF,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,UAAC,IAAI,EAAE,EAAE;YACtC,IAAI,SAAS,GAAG,EAAE,CAAC;YACnB,IAAI,IAAI,IAAI,KAAI,CAAC,KAAK,CAAC,WAAW,EAAE;gBAChC,SAAS,GAAG,OAAO,CAAC;aACvB;YACD,OAAO,uCAAK,SAAS,EAAE,iBAAiB,GAAG,SAAS,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,EAAE,IAAG,IAAI,CAAO,CAAA;QACzF,CAAC,CAAC,CAAA;QAEF,IAAI,YAAY,GAAG,EAAE,CAAC;QACtB,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;YACtB,YAAY,GAAG,OAAO,CAAC;SAC1B;QAED,OAAO,CACH,uCAAK,EAAE,EAAC,OAAO;YACX,uCAAK,EAAE,EAAC,QAAQ,aAEV;YACN,uCAAK,EAAE,EAAC,SAAS,EAAC,GAAG,EAAE,IAAI,CAAC,UAAU;gBAClC,8BAAC,iBAAO,IAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EACpC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,EAC/B,kBAAkB,EAAE,IAAI,CAAC,kBAAkB,GACzC;oBACA;YACN,uCAAK,EAAE,EAAC,OAAO;gBACV,KAAK;gBACN,uCAAK,EAAE,EAAC,UAAU,EAClB,SAAS,EAAE,YAAY,GAAG,YAAY,EACtC,OAAO,EAAE,IAAI,CAAC,kBAAkB,EAAE,GAAG,EAAE,IAAI,CAAC,aAAa;oBACrD,qCAAG,SAAS,EAAC,gBAAgB,GAAK,CAAM,CAC1C;YACL,MAAM,IAAI,8BAAC,cAAI,IAAC,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,GAAG,CACrE,CACT,CAAA;IACL,CAAC;IACL,YAAC;AAAD,CAAC,AAhHD,CAAmC,eAAK,CAAC,SAAS,GAgHjD","sourcesContent":["import React, { Ref } from \"react\";\r\nimport Chat from \"./chat\";\r\nimport { socket } from \"../../main\";\r\nimport Players from \"./players\";\r\n\r\n\r\n\r\nexport interface IPlayer {\r\n    name: string,\r\n    avatar: {\r\n        theme: string,\r\n        shape: string,\r\n    },\r\n    id: string,\r\n}\r\n\r\ntype Props = {\r\n\r\n}\r\ntype State = {\r\n    players: IPlayer[],\r\n    rooms: string[],\r\n    currentRoom: string,\r\n    canInvite: boolean,\r\n}\r\n\r\n\r\nexport default class Lobby extends React.Component<Props, State> {\r\n\r\n    props: {\r\n        name: string,\r\n        \r\n    }\r\n    playersRef: React.RefObject<HTMLDivElement>\r\n    createRoomRef: React.RefObject<HTMLDivElement>\r\n    avatar: any;\r\n    name: any;\r\n    id: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.props = props;\r\n        this.state = {\r\n            players: [],\r\n            rooms: [\"global room\"],\r\n            currentRoom: \"global room\",\r\n            canInvite: false,\r\n        }\r\n        this.playersRef = React.createRef();\r\n        this.createRoomRef = React.createRef();\r\n    }\r\n\r\n    createRoom = (name: string) => {\r\n        if (!this.state.rooms.includes(name) && name !== this.props.name) {\r\n            this.setState(prevState => {\r\n                return {\r\n                    rooms: [...prevState.rooms, name],\r\n                    currentRoom: name,\r\n                    canInvite: false,\r\n                }\r\n            });\r\n        }\r\n        let roomName = this.props.name + name;\r\n    }\r\n\r\n    handlePlayerInvite = (event: any) => {\r\n        const target = event.target as HTMLElement;\r\n        let player = target.closest(\".player\")\r\n\r\n        if (this.state.canInvite && player) {\r\n            this.createRoom(player.id);\r\n            console.log(target.id)\r\n        }\r\n    }\r\n    \r\n    handleClickNewRoom =() => {\r\n        this.setState({canInvite: true});\r\n    }\r\n    \r\n    handleOutsidePlayersClick = (event: any) => {\r\n        const {target} = event\r\n        if (!this.playersRef.current?.contains(target) && !this.createRoomRef.current?.contains(target)) {\r\n            this.setState({canInvite: false});\r\n        }\r\n        \r\n    }\r\n\r\n    componentDidMount = () => {\r\n        socket.on(\"players_update\", (players) => {\r\n            this.setState({players})\r\n        })\r\n        document.addEventListener('click', this.handleOutsidePlayersClick);\r\n\r\n    }\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleOutsidePlayersClick);\r\n        socket.off(\"players_update\")\r\n    }\r\n\r\n    render() {\r\n        \r\n\r\n        const player = this.state.players.find((player) => player.name == this.props.name)\r\n\r\n        let rooms = this.state.rooms.map((room, id) => {\r\n            let roomClass = \"\";\r\n            if (room == this.state.currentRoom) {\r\n                roomClass = \"green\";\r\n            }\r\n            return <div className={\"room no-select \" + roomClass} id={room} key={id}>{room}</div>\r\n        })\r\n\r\n        let newRoomClass = \"\";\r\n        if (this.state.canInvite) {\r\n            newRoomClass = \"green\";\r\n        }\r\n\r\n        return (\r\n            <div id=\"lobby\">\r\n                <div id=\"invite\">\r\n                    Invite\r\n                </div>\r\n                <div id=\"players\" ref={this.playersRef}>\r\n                    <Players players={this.state.players} \r\n                    canInvite={this.state.canInvite}\r\n                    handlePlayerInvite={this.handlePlayerInvite}\r\n                    />;\r\n                </div>\r\n                <div id=\"rooms\">\r\n                    {rooms}\r\n                    <div id=\"new-room\" \r\n                    className={\"no-select \" + newRoomClass} \r\n                    onClick={this.handleClickNewRoom} ref={this.createRoomRef}>\r\n                        <i className=\"icon-user-plus\"></i></div>\r\n                </div>\r\n                {player && <Chat player={player} currentRoom={this.state.currentRoom}/>}\r\n            </div>\r\n        )\r\n    }\r\n}"]}