{"version":3,"file":"board.js","sourceRoot":"","sources":["../src/board.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { MouseEventHandler, useState } from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport TopLabel from './components/labels/top-label';\r\nimport LeftLabel from './components/labels/left-label';\r\nimport Chessboard from './components/board/chessboard';\r\nimport RightLabel from './components/labels/right-label';\r\nimport BotLabel from './components/labels/bot-label';\r\nimport ContextMenu from \"./components/board/context-menu\";\r\nimport {animateFog} from \"./bGroundAnimation\";\r\nimport WinMenu from \"./components/board/winMenu\";\r\n\r\nimport { GAMEMODE } from './game';\r\nimport {Engine} from './engine';\r\nimport Game from \"./game\";\r\n\r\ntype MyState = {\r\n    contextMenu: {\r\n    piece: string,\r\n    queen: boolean,\r\n    i: number,\r\n    clientX : number,\r\n    clientY: number,\r\n    showMenu: boolean\r\n    },\r\n    game: Game,\r\n    \r\n}\r\ntype MyProps = {\r\n\r\n}\r\n\r\n// const enum GAMEMODE {\r\n//     LOCAL,\r\n//     BOT,\r\n//     ONLINE\r\n// }\r\n\r\n\r\n\r\nexport default class Board extends React.Component<MyProps, MyState> {\r\n\r\n    static propTypes: {};\r\n    interval: ReturnType<typeof setTimeout> | null;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = { \r\n            contextMenu: {\r\n                piece: \"\",\r\n                queen : false, \r\n                i : 0,\r\n                clientX : 0, \r\n                clientY : 0,\r\n                showMenu : false,\r\n            },\r\n            game: new Game(GAMEMODE.BOT, \"white\"),\r\n        };\r\n        this.interval = null;\r\n        this.state.game.startNewGame();\r\n        this.restartGame = this.restartGame.bind(this);\r\n    }\r\n\r\n    clickHandler = (event: any) => {\r\n        this.setState({contextMenu: {...this.state.contextMenu, showMenu: false}});\r\n        this.forceUpdate()\r\n        \r\n    }\r\n\r\n    onContextHandler = (event: any) => {\r\n        event.preventDefault();\r\n        let engine = this.state.game.engine;\r\n\r\n        let square = event.target.closest(\".square\");\r\n        let id;\r\n        let queen;\r\n        let piece;\r\n        let clientX\r\n        let clientY\r\n        if (square && square.className !== \"square white\") {\r\n            id = square.getAttribute(\"id\");\r\n            queen = engine.chessboard[id][\"queen\"]\r\n            piece = engine.chessboard[id][\"piece\"]\r\n            let clientRect = square.getBoundingClientRect();\r\n            clientX = clientRect.left;\r\n            clientY = clientRect.top;\r\n            let width = square.offsetWidth;\r\n            let height = square.offsetHeight;\r\n            clientX += width / 2;\r\n            clientY += height / 2 + 10;\r\n\r\n            this.setState({contextMenu: {\r\n                piece: piece,\r\n                queen : queen, \r\n                i : id,\r\n                clientX : clientX, \r\n                clientY : clientY,\r\n                showMenu : true,\r\n            }})\r\n        }\r\n        \r\n        return false;\r\n    }\r\n\r\n\r\n    componentDidUpdate() {\r\n        let engine = this.state.game.engine;\r\n        // context menu managment\r\n        let contextMenu = document.getElementById('contextMenu');\r\n        if (contextMenu) {\r\n            let attribute = \"left: \" + this.state.contextMenu.clientX + \"px; \"\r\n            attribute += \"top: \" + this.state.contextMenu.clientY + \"px; \"\r\n            if (this.state.contextMenu.showMenu) {\r\n                attribute += \"visibility: visible\";\r\n            } else {\r\n                attribute += \"visibility: hidden\";\r\n            }\r\n            contextMenu.setAttribute(\"style\", attribute);\r\n        }\r\n\r\n        // win menu managment\r\n        let winMenu = document.getElementById('winMenu');\r\n        if (winMenu) {\r\n            if (engine.winner) {\r\n                winMenu.setAttribute(\"style\", \"visibility: visible\");\r\n            } else {\r\n                winMenu.setAttribute(\"style\", \"visibility: hidden\");\r\n            }\r\n        }\r\n    }\r\n\r\n    restartGame() {\r\n        this.setState({game: new Game(GAMEMODE.LOCAL, \"white\")});\r\n        restartFlag = true;\r\n        \r\n    }\r\n\r\n    render() {\r\n        if (restartFlag) {\r\n            let chessboard = this.state.game.startNewGame();\r\n            this.state.game.makeChessboardInteractive(chessboard);\r\n            restartFlag = false;\r\n        }\r\n        let engine = this.state.game.engine;\r\n        let ctxMenu = this.state.contextMenu;\r\n        return (\r\n            <div id=\"game\"  onClick={this.clickHandler} onContextMenu={this.onContextHandler}>\r\n                <WinMenu winner={engine.winner} restart={this.restartGame}/>\r\n                <TopLabel/>\r\n                <LeftLabel/>\r\n                <Chessboard engine = {engine} preview = {false}/>\r\n                <RightLabel/>\r\n                <BotLabel/>\r\n                <ContextMenu piece={ctxMenu.piece} queen ={ctxMenu.queen} id={ctxMenu.i} chessboard={engine.chessboard}/>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.state.game.makeChessboardInteractive(this.state.game.engine.chessboard);\r\n        this.interval = setInterval(() => {\r\n            this.forceUpdate()\r\n        }, 100)\r\n    }\r\n    componentWillUnmount() {\r\n        if (this.interval) {\r\n            clearInterval(this.interval);\r\n        }\r\n    }\r\n}\r\n\r\nlet restartFlag = false;\r\n\r\n\r\nanimateFog(30);"]}